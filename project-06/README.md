# 基于椭圆曲线与Paillier同态加密的 Google Password Checkup 协议实现

---

## 一、实验背景与目标

随着网络服务普及，密码泄露频发，用户密码安全面临严峻挑战。Google Password Checkup 提供了一种隐私保护的密码泄露检测方案，允许用户在不暴露密码明文的情况下，检测其密码是否已泄露。

本实验基于椭圆曲线密码学（ECC）和 Paillier 同态加密，复现该协议核心思想，实现客户端与服务端的交互流程，确保密码隐私的同时，实现泄露密码的安全匹配统计。

---

## 二、协议设计与技术要点

### 2.1 技术组件

- **椭圆曲线密码学 (ECC)**  
  采用 P-256 曲线（secp256r1），利用曲线上的点乘实现密码标识的安全映射及盲化。

- **Paillier 同态加密**  
  实现服务端对匹配计数的加密求和，客户端无需获知计数明文，确保隐私。

### 2.2 协议流程简述

1. **客户端准备**  
   对用户的密码标识符（如 `"pw:alice123"`）进行 SHA-256 哈希，映射为曲线标量 `s`，再计算点 `s*G`，并盲化为 `k1 * (s*G)` 发送给服务端。

2. **服务端准备**  
   对泄露密码列表做同样的标量映射及盲化（用其私有盲化因子 `k2`），生成加密计数，返回盲化点集和加密计数。

3. **交互计算**  
   客户端使用自身盲化因子 `k1` 对服务端返回的点集盲化值进行匹配，确定交集密码的加密计数集合。

4. **同态求和**  
   客户端对匹配的加密计数使用 Paillier 加法同态进行求和，返回加密求和结果。

5. **服务端解密**  
   服务端对加密求和结果解密，得出匹配密码的泄露总次数。

---

## 三、实现细节

### 3.1 ECC操作

- 使用 Python `tinyec` 库管理曲线点及标量乘法。  
- 哈希密码标识符到标量，计算点乘并进行双重盲化（客户端`k1`，服务端`k2`）。  
- 实现点与十六进制字符串之间的转换以方便传输。

### 3.2 Paillier加密

- 服务端生成 Paillier 公私钥对，公钥发送客户端。  
- 服务端对泄露密码的泄露计数加密。  
- 客户端将匹配密码的加密计数同态求和后发送给服务端。

### 3.3 通信协议

- 采用 TCP 套接字，使用 JSON 格式封装消息。  
- 定义三轮交互消息：  
  - `ROUND1`：客户端发送盲化后的点集  
  - `ROUND2`：服务端返回盲化点集、加密计数和 Paillier 公钥  
  - `ROUND3`：客户端发送加密计数求和  

---

## 四、实验环境与运行

- 语言：Python 3  
- 依赖库：`tinyec`（ECC支持）、`phe`（Paillier加密）、`socket`、`hashlib`  
- 测试环境：本地回环地址（127.0.0.1）通信，模拟客户端和服务端交互  

---

## 五、实验结果

### 5.1 泄露密码集合示例

| 密码标识符     | 泄露计数 |
|--------------|--------|
| pw:qwerty    | 1000   |
| pw:123456    | 5000   |
| pw:letmein   | 800    |
| pw:password  | 3000   |

### 5.2 客户端测试密码集合

| 密码标识符       |
|----------------|
| pw:alice123    |
| pw:qwerty      |
| pw:letmein    |
| pw:unique_pass_42 |

### 5.3 运行流程与输出

- 客户端发送盲化点集 `ROUND1`。  
- 服务端返回盲化点集 `Z` 和泄露计数加密对 `enc_pairs`，并附带 Paillier 公钥。  
- 客户端计算交集并对对应泄露计数密文求和，发送加密结果 `ROUND3`。  
- 服务端解密求和，输出匹配密码泄露计数总和。

---

## 六、安全性分析

- **密码隐私保护**  
  双盲化保证客户端和服务端均无法获知对方密码明文或中间状态密码信息。  

- **同态加密保证**  
  Paillier加密实现泄露计数加密求和，防止计数泄露给客户端。  

- **抗重放与排序混淆**  
  交互过程中对点集和加密对随机洗牌，避免通过顺序推断信息。  

- **通信安全**  
  本实验为演示用未启用传输层加密，实际部署应结合TLS等安全信道。  

---

## 七、实验结果展示
<img width="1420" height="244" alt="image" src="https://github.com/user-attachments/assets/61de0907-eacd-45e1-bc48-e3818eb97d28" />
<img width="1419" height="163" alt="image" src="https://github.com/user-attachments/assets/c6be4717-26a4-4ba4-bc4f-e45b61f99750" />






